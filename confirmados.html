<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lista de Confirmados</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Bebas Neue', sans-serif;
      background: #111;
      color: white;
      padding: 15px;
      text-align: center;
      margin: 0;
    }
    h1 {
      margin-bottom: 20px;
      font-size: 32px;
      letter-spacing: 1px;
    }
    .search-container {
      margin-bottom: 20px;
      max-width: 100%;
    }
    .search-input {
      width: 90%;
      max-width: 400px;
      padding: 12px 15px;
      font-size: 16px;
      background: #222;
      border: 2px solid #444;
      border-radius: 4px;
      color: white;
      font-family: inherit;
    }
    .search-input::placeholder {
      color: #999;
    }
    .guest-list {
      max-width: 100%;
      margin: 0 auto;
      text-align: left;
    }
    .guest {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 10px;
      border-bottom: 1px solid #444;
      position: relative;
    }
    label {
      flex-grow: 1;
      font-size: 18px;
      padding-right: 15px;
      line-height: 1.3;
      word-break: break-word;
    }
    input[type="checkbox"] {
      -webkit-appearance: none;
      appearance: none;
      width: 28px;
      height: 28px;
      border: 2px solid white;
      border-radius: 3px;
      background: transparent;
      position: relative;
      flex-shrink: 0;
      cursor: pointer;
    }
    input[type="checkbox"]:checked::before {
      content: "✓";
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 20px;
      color: white;
    }
    .btn {
      margin-top: 30px;
      padding: 15px 25px;
      background: transparent;
      border: 2px solid white;
      color: white;
      text-transform: uppercase;
      cursor: pointer;
      font-size: 18px;
      transition: 0.3s;
      border-radius: 4px;
    }
    .btn:hover {
      background: rgba(255,255,255,0.1);
    }
    .no-results {
      text-align: center;
      padding: 20px;
      color: #999;
      font-size: 18px;
    }

    /* Media queries para responsividad */
    @media (max-width: 480px) {
      body {
        padding: 10px;
      }
      h1 {
        font-size: 28px;
        margin-bottom: 15px;
      }
      .search-input {
        padding: 10px 12px;
        font-size: 14px;
      }
      .guest {
        padding: 15px 8px;
      }
      label {
        font-size: 16px;
        padding-right: 12px;
      }
      input[type="checkbox"] {
        width: 24px;
        height: 24px;
      }
      input[type="checkbox"]:checked::before {
        font-size: 16px;
      }
      .btn {
        padding: 12px 20px;
        font-size: 16px;
        margin-top: 25px;
      }
    }

    @media (max-width: 360px) {
      h1 {
        font-size: 24px;
      }
      label {
        font-size: 15px;
      }
    }
  </style>
</head>
<body>
  <h1>Invitados Confirmados</h1>
  
  <!-- Campo de búsqueda -->
  <div class="search-container">
    <input type="text" id="searchInput" class="search-input" placeholder="Buscar por nombre...">
  </div>
  
  <div class="guest-list" id="guestList"></div>
  <button class="btn" onclick="exportarExcel()">Exportar a Excel</button>

  <!-- Librería SheetJS para exportar -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <script>
    // Lista de invitados
    const invitados = [
      "Felix Obregon", "Carlos Ortiz", "Angel Rangel", "Gerardo Alvarez", "Carlos Mendez",
      "Javier Peña", "Jorge Orta", "Rafael Martinez", "Raul Fong", "Manuel Salazar",
      "Horacio Azpeitia", "Fernando Gomez", "Mario Garza", "Jorge Garza", "Julio Tovar",
      "Julio Tovar", "Jorge Garduño", "Manuel Peña", "Luis Marquez", "Julio Franco",
      "Adrian Montemayor", "Jesus Vielma"
    ];

    const guestListDiv = document.getElementById("guestList");
    const searchInput = document.getElementById("searchInput");

    // Estado desde LocalStorage
    const confirmados = JSON.parse(localStorage.getItem("confirmados")) || {};

    // Función para renderizar la lista de invitados
    function renderGuestList(filteredInvitados = invitados) {
      guestListDiv.innerHTML = '';
      
      if (filteredInvitados.length === 0) {
        guestListDiv.innerHTML = '<div class="no-results">No se encontraron resultados</div>';
        return;
      }
      
      filteredInvitados.forEach(nombre => {
        const div = document.createElement("div");
        div.className = "guest";

        const label = document.createElement("label");
        label.textContent = nombre;
        label.style.cursor = "pointer";

        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.checked = confirmados[nombre] || false;
        checkbox.id = "invitado-" + nombre.replace(/\s+/g, '-');

        label.setAttribute("for", checkbox.id);

        checkbox.addEventListener("change", () => {
          if (!checkbox.checked) {
            const seguro = confirm("¿Seguro que quieres quitar a " + nombre + " de confirmados?");
            if (!seguro) {
              checkbox.checked = true;
              return;
            }
          }
          confirmados[nombre] = checkbox.checked;
          localStorage.setItem("confirmados", JSON.stringify(confirmados));
        });

        div.appendChild(label);
        div.appendChild(checkbox);
        guestListDiv.appendChild(div);
      });
    }

    // Función para filtrar invitados según la búsqueda
    function filtrarInvitados() {
      const searchTerm = searchInput.value.toLowerCase().trim();
      
      if (!searchTerm) {
        renderGuestList();
        return;
      }
      
      const filtered = invitados.filter(nombre => 
        nombre.toLowerCase().includes(searchTerm)
      );
      
      renderGuestList(filtered);
    }

    // Event listener para el campo de búsqueda
    searchInput.addEventListener('input', filtrarInvitados);

    // Renderizar lista inicial
    renderGuestList();

    function exportarExcel() {
      const data = [["Invitado", "Confirmado"]];
      invitados.forEach(nombre => {
        data.push([nombre, confirmados[nombre] ? "Sí" : "No"]);
      });

      const wb = XLSX.utils.book_new();
      const ws = XLSX.utils.aoa_to_sheet(data);
      XLSX.utils.book_append_sheet(wb, ws, "Confirmados");

      XLSX.writeFile(wb, "confirmados.xlsx");
    }
  </script>
</body>
</html>