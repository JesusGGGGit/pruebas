<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Reproducir/Pausar Audio iPad</title>
<style>
  body {
    font-family: Arial, sans-serif;
    text-align: center;
    padding-top: 50px;
  }
  #btnReproducir {
    padding: 20px 40px;
    font-size: 20px;
    cursor: pointer;
    border: none;
    background-color: #007bff;
    color: white;
    border-radius: 8px;
  }
  #btnReproducir:hover { background-color: #0056b3; }
</style>
</head>
<body>

<h2>Control de Audio</h2>

<button id="btnReproducir">Tocar canción</button>

<script>
(function () {
  // Verifica compatibilidad con Web Audio API
  if ("AudioContext" in window || "webkitAudioContext" in window) {
    var AudioContext = window.AudioContext || window.webkitAudioContext;
    var context = new AudioContext();
    var gainNode = context.createGain();
    gainNode.gain.value = 1;
    gainNode.connect(context.destination);

    var audioBuffer;
    var playingSource = null; // Fuente actual
    var boton = document.getElementById("btnReproducir");
    var soundUrl = "https://raw.githubusercontent.com/JesusGGGGit/pruebas/main/song/song.mp3";

    // Cargar audio
    fetch(soundUrl)
      .then(response => response.arrayBuffer())
      .then(arrayBuffer =>
        context.decodeAudioData(
          arrayBuffer,
          function(buffer) {
            audioBuffer = buffer;
          },
          function(err) { console.error(err); }
        )
      );

    // Función para reproducir o pausar
    function toggleAudio() {
      if (!audioBuffer) return; // Aún no cargó

      if (playingSource) {
        // Pausar
        playingSource.stop();
        playingSource = null;
        boton.textContent = "Tocar canción";
      } else {
        // Reproducir
        var source = context.createBufferSource();
        source.buffer = audioBuffer;
        source.connect(gainNode);
        source.start(0);
        playingSource = source;
        boton.textContent = "Pausar canción";

        // Cuando termina la canción
        source.onended = function() {
          playingSource = null;
          boton.textContent = "Tocar canción";
        };
      }
    }

    boton.addEventListener("click", toggleAudio);

    // Desbloquear audio en iOS
    function unlock() {
      var buffer = context.createBuffer(1, 1, 22050);
      var src = context.createBufferSource();
      src.buffer = buffer;
      src.connect(context.destination);
      src.start ? src.start(0) : src.noteOn(0);
    }
    unlock();

  } else {
    alert("Tu navegador no soporta Web Audio API");
  }
})();
</script>

</body>
</html>
